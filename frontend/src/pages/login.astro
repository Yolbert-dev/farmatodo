---
import Notification from "../features/notifications/Notification.astro";
import '../styles/global.css';
import ImgTienda from '../assets/tiendaefecto.png'
import Logo from '../assets/logo.jpg'
const { title } = Astro.props;
---

<!doctype html>
<html lang="en">


    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width" />
        <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
        <meta name="generator" content={Astro.generator} />
        <title>{title}</title>
    </head>
    <body>
        <Notification/>
        
  
        <slot />
         
        <div class="grid md:grid-cols-2 min-h-screen">
            <div class="hidden md:block h-screen overflow-hidden">
                <img 
                    src={ImgTienda.src} 
                    alt="Imagen de farmacia" 
                    class="object-cover w-full h-full transform transition-all duration-500 ease-in-out hover:scale-110 hover:brightness-105"
                >
            </div>
            
            <div class="flex items-center justify-center p-6 md:p-12 relative bg-gradient-to-br from-gray-50 to-gray-100">
                <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
                    <img class="text-9xl font-bold text-blue-500 rounded-full opacity-10 select-none" src={Logo.src} alt="">
                </div>
                
                <div class="w-full max-w-sm relative z-10">
                    <h1 class="text-4xl font-extrabold text-center text-blue-500 mb-8">
                        Farmatodo
                    </h1>

                    <form id="loginForm" novalidate>
                        
                        <div class="relative z-0 w-full mb-8 group">
                            <input 
                                type="text" 
                                name="id_codigo" 
                                id="id_codigo"
                                class="block py-2.5 px-0 w-full text-lg text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-500 peer" 
                                placeholder=" " 
                                required 
                            />
                            <label 
                                for="id_codigo" 
                                class="peer-focus:font-medium absolute text-lg text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                            >
                                Código de Usuario
                            </label>
                        </div>

                        <div class="relative z-0 w-full mb-10 group">
                            <input 
                                type="password" 
                                name="password" 
                                id="password" 
                                class="block py-2.5 px-0 w-full text-lg text-gray-900 bg-transparent border-0 border-b-2 border-gray-300 appearance-none focus:outline-none focus:ring-0 focus:border-blue-500 peer" 
                                placeholder=" " 
                                required 
                            />
                            <label 
                                for="password" 
                                class="peer-focus:font-medium absolute text-lg text-gray-500 duration-300 transform -translate-y-6 scale-75 top-3 -z-10 origin-[0] peer-focus:start-0 rtl:peer-focus:translate-x-1/4 peer-focus:text-blue-500 peer-placeholder-shown:scale-100 peer-placeholder-shown:translate-y-0 peer-focus:scale-75 peer-focus:-translate-y-6"
                            >
                                Clave
                            </label>
                        </div>

                        <button 
                            type="submit" 
                            class="w-full bg-blue-500 text-white font-bold py-3 px-4 rounded-lg
                                    hover:bg-blue-800 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500
                                    transition-colors duration-300"
                        >
                            Ingresar
                        </button>
                    </form>

                    <p id="errorMessage" class="mt-4 text-center text-red-500 font-semibold"></p>
                </div>
            </div>
        </div>






        <script>
            // @ts-nocheck
              import { BACK_ENDPOINT } from "../config/endpoints";
              import AuthModule from "../features/auth/auth.module";
              import { createNotification } from "../features/notifications/notificiation";
              import ky from 'ky';

     document.addEventListener('DOMContentLoaded', () => {
                const loginForm = document.getElementById('loginForm');
                const errorMessage = document.getElementById('errorMessage');
                const menuToggle = document.getElementById('menuToggle');
                const mobileMenu = document.getElementById('mobileMenu');






                // Funcionalidad del menú móvil
                menuToggle?.addEventListener('click', () => {
                    mobileMenu?.classList.toggle('hidden');
                });





                // Funcionalidad del login
                loginForm.addEventListener('submit', (event) => {
                    event.preventDefault(); 
                    errorMessage.textContent = '';
                    const codigoUsuario = document.getElementById('codigo-usuario').value;
                    const clave = document.getElementById('clave').value;




                    if (codigoUsuario.trim() === '' || clave.trim() === '') {
                        errorMessage.textContent = 'Por favor, completa ambos campos.';
                        return; 
                    }

                    console.log('Datos enviados:', { codigoUsuario, clave });
                    alert(`¡Bienvenido! \nUsuario: ${codigoUsuario}`);
                    loginForm.reset();
                });
            });


  // DOM Element Selection
  const form = document.querySelector('#loginForm');
  const id_codigo = document.querySelector('#id_codigo');
  const passwordInput = document.querySelector('#password');

  // Form Submission
  form.addEventListener('submit', async (event) => {
    event.preventDefault();

    try {
      await AuthModule.login({id_codigo: Number(id_codigo.value), passwordhash: passwordInput.value});
      location.assign('/');
    } catch (error) {
      console.log(error);
      
      const errorData = await error?.response?.json();
      createNotification({ 
        title: 'Ups! Hubo un error', 
        description: errorData?.error ?? 'Sin mensaje', 
        type: 'error'
      });
    }  
  });


        </script>
    </body>
</html>





